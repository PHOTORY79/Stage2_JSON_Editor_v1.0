{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Stage 2 Film Framework Schema",
  "type": "object",
  "required": [
    "film_id",
    "current_step",
    "timestamp",
    "scenes"
  ],
  "additionalProperties": false,
  "properties": {
    "film_id": {
      "type": "string",
      "pattern": "^FILM_[0-9]{6}$"
    },
    "current_step": {
      "type": "string",
      "enum": [
        "shot_division_2A",
        "visual_direction_2B"
      ]
    },
    "timestamp": {
      "type": "string",
      "format": "date-time"
    },
    "scenes": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/scene"
      }
    }
  },
  "$defs": {
    "scene": {
      "type": "object",
      "required": [
        "scene_id",
        "scene_title",
        "scene_scenario",
        "concept_art_references",
        "shots"
      ],
      "additionalProperties": false,
      "properties": {
        "scene_id": {
          "type": "string",
          "pattern": "^S[0-9]{2}$"
        },
        "scene_title": {
          "type": "string",
          "minLength": 1
        },
        "scene_scenario": {
          "type": "string",
          "minLength": 1
        },
        "concept_art_references": {
          "type": "object",
          "required": [
            "characters",
            "location",
            "props"
          ],
          "additionalProperties": false,
          "properties": {
            "characters": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "location": {
              "type": "string"
            },
            "props": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "shots": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/shot"
          }
        }
      }
    },
    "shot": {
      "type": "object",
      "required": [
        "shot_id",
        "shot_type",
        "shot_text",
        "shot_character",
        "scene",
        "movement_description",
        "camera_movement",
        "starting_frame",
        "ending_frame"
      ],
      "additionalProperties": false,
      "properties": {
        "shot_id": {
          "type": "string",
          "pattern": "^S[0-9]{2}\\.[0-9]{2}\\.[0-9]{2}$"
        },
        "shot_type": {
          "type": "string",
          "enum": [
            "regular"
          ]
        },
        "shot_text": {
          "type": "string",
          "minLength": 1
        },
        "shot_character": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Characters actually appearing in this shot (subset of concept_art_references.characters or empty array)"
        },
        "scene": {
          "type": "string",
          "minLength": 1
        },
        "movement_description": {
          "$ref": "#/$defs/movement_description"
        },
        "camera_movement": {
          "$ref": "#/$defs/camera_movement"
        },
        "starting_frame": {
          "$ref": "#/$defs/frame"
        },
        "ending_frame": {
          "$ref": "#/$defs/frame"
        }
      }
    },
    "movement_description": {
      "type": "object",
      "required": [
        "action",
        "expression",
        "environment_move",
        "mood_emotion"
      ],
      "additionalProperties": false,
      "properties": {
        "action": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "expression": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "environment_move": {
          "type": "string"
        },
        "mood_emotion": {
          "type": "string"
        }
      }
    },
    "camera_movement": {
      "type": "object",
      "required": [
        "type"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "static",
            "pan",
            "tilt",
            "dolly_in",
            "dolly_out",
            "dolly_zoom",
            "track",
            "truck",
            "crane",
            "crane_up",
            "crane_down",
            "handheld",
            "steadicam",
            "zoom",
            "rack_focus",
            "arc",
            "whip_pan",
            "whip_pan_down",
            "dutch_angle",
            "overhead",
            "worm_view",
            "spiral",
            "pendulum",
            "drift",
            "snap_zoom",
            "push_in",
            "pull_out",
            "slow_push_in",
            "quick_pull_back",
            "tracking_backward",
            "tracking_left",
            "tilt_down_then_focus"
          ]
        },
        "speed": {
          "type": "string",
          "enum": [
            "very_slow",
            "slow",
            "medium",
            "fast",
            "match_subject"
          ]
        },
        "duration": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]+)?s$"
        },
        "secondary": {
          "type": "string"
        },
        "focus_shift": {
          "type": "string"
        }
      }
    },
    "frame": {
      "type": "object",
      "required": [
        "camera_composition",
        "environment"
      ],
      "additionalProperties": true,
      "properties": {
        "camera_composition": {
          "type": "string",
          "minLength": 1
        },
        "environment": {
          "type": "string",
          "minLength": 1
        }
      },
      "patternProperties": {
        "^[A-Za-z_]+$": {
          "type": "string"
        }
      }
    }
  }
}